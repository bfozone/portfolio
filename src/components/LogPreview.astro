---
import { getCollection } from "astro:content";

const PREVIEW_LIMIT = 4;

const allLogs = await getCollection("log");
const recentLogs = allLogs
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, PREVIEW_LIMIT);

function formatDate(date: Date): string {
  return date.toISOString().split("T")[0];
}
---

<section id="log" class="py-20">
  <div class="max-w-5xl mx-auto px-4 sm:px-6">
    <div class="fade-in">
      <p class="font-mono text-sm text-[var(--ctp-green)] mb-8">
        &gt; log.latest
      </p>
    </div>

    <div class="space-y-4 max-w-3xl">
      {
        recentLogs.map(async (entry, index) => {
          const { Content } = await entry.render();
          return (
            <article
              class="fade-in border-l-2 border-[var(--ctp-surface1)] hover:border-[var(--ctp-mauve)] pl-4 py-2 transition-colors duration-200"
              style={`transition-delay: ${index * 50}ms`}
            >
              <div class="flex items-start gap-3">
                <time
                  datetime={entry.data.date.toISOString()}
                  class="font-mono text-sm text-[var(--ctp-mauve)] shrink-0"
                >
                  {formatDate(entry.data.date)}
                </time>
                <div class="text-[var(--ctp-subtext0)] text-sm leading-relaxed line-clamp-2">
                  <Content />
                </div>
              </div>
            </article>
          );
        })
      }
    </div>

    <div class="fade-in mt-8" style="transition-delay: 200ms">
      <a
        href="/log"
        class="font-mono text-sm text-[var(--ctp-subtext0)] hover:text-[var(--ctp-mauve)] transition-colors"
      >
        &gt; view all entries
      </a>
    </div>
  </div>
</section>
